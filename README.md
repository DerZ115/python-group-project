<div tabindex="-1" id="notebook" class="border-box-sizing">

<div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">

<div class="text_cell_render border-box-sizing rendered_html">

Final assignment, 09.11.2020 ("Grundlagen der Programmierung in Python", Bio Data Science, WS 2020/21)

</div>

</div>

</div>

<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">

<div class="text_cell_render border-box-sizing rendered_html">

# A study of conserved genes, using the eggNOG database[¶](#A-study-of-conserved-genes,-using-the-eggNOG-database)

General notes:

*   You can work in groups of 3-4 people.
*   Don't exchange code between groups. If your solution is a plagiarism, it will not be counted. (Consulting Stackoverflow for general questions and using the corresponding code is fine.)
*   Maximum achievable points: 20 points + bonus points
*   Submission deadline: 04.12.2020, 23:59 (Moodle)

</div>

</div>

</div>

<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">

<div class="text_cell_render border-box-sizing rendered_html">

## Background information[¶](#Background-information)

In any organism group (like Eukaryota, Fungi or Mammalia), a number of genes are shared among distantly related lineages, making it probable that they were inherited from the [last common ancestor](https://en.wikipedia.org/wiki/Most_recent_common_ancestor) of this group. Such genes in different organisms, that descend from a common ancestor gene, are called [orthologs](https://en.wikipedia.org/wiki/Sequence_homology#Orthology). However, many of these genes were lost in specific lineages, and only a few are universal to the whole taxonomic group (i.e., occur in all members of that group). These patterns of gene conservation and gene loss are used for functional and evolutionary studies.

One object of study are highly conserved single-copy genes. They often encode ancient parts of the translation machinery, which is the same in all living organisms, and are useful e.g. for taxonomic profiling of environmental samples ([Sunagawa et al., 2013](https://www.nature.com/articles/nmeth.2693)). To identify such genes, we can compare the genetic contents of all Bacteria, Archaea and Eukaryota, and determine groups of orthologous genes and organisms in which they are present or absent. Luckily, we don't have to do this ourselves: It has already been done, and the results are provided in [databases](https://en.wikipedia.org/wiki/Sequence_homology#Databases_of_orthologous_genes), like the [eggNOG database](http://eggnogdb.embl.de) ("evolutionary genealogy of genes: Non-supervised Orthologous Groups"). We can use this data to answer our questions.

</div>

</div>

</div>

<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">

<div class="text_cell_render border-box-sizing rendered_html">

*   The review "Orthologs, Paralogs, and Evolutionary Genomics" ([EV Koonin, Annu. Rev. Genet. 2005](https://www.annualreviews.org/doi/full/10.1146/annurev.genet.39.073003.114725)) provides a good introduction to evolutionary genomics.
*   An early version of a database of orthologous genes was published in 2000 as "The COG database: a tool for genome-scale analysis of protein functions and evolution" ([Tatusov et al., NAR 2000](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC102395/)). This COG ("Clusters of Orthologous Groups of proteins") database was generated by comparing proteins between all sequenced microbial genomes via sequence similarity searches to infer sets of orthologs. Each COG consists of a group of proteins found to be orthologous across at least three lineages and likely corresponds to an ancient conserved domain.
*   The eggNOG database ("eggNOG: automated construction and annotation of orthologous groups of genes", [Jensen et al., NAR 2008](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2238944/)), currently at release 5.0 ("eggNOG 5.0: a hierarchical, functionally and phylogenetically annotated orthology resource based on 5090 organisms and 2502 viruses", [Jaime Huerta-Cepas et al., NAR 2018](https://%22academic.oup.com/nar/article/47/D1/D309/5173662)), is built upon the COG database and provides information about orthologous groups on many evolutionary levels.

The data of the eggNOG database can be accessed from the [eggNOG website](http://eggnog5.embl.de/#/app/home) or [downloaded](http://eggnog5.embl.de/download/) as tab-separated text files. E.g., the file `2157_members.tsv.gz` lists archaeal OGs, proteins that comprise the OGs and the [taxonomy ids](https://www.uniprot.org/help/taxonomic_identifier) of the organisms. (The protein sequence identifers have the eggNOG-specific format `taxonomy_id.unique_id`.) This gives information about which genes in a particular species correspond by an evolutionary relationship to which genes in other species. The `*_annotations.tsv` files contain the functional characterization of OGs (if available), as human-readable functional description and/or as [single-letter functional codes](http://eggnogdb.embl.de/download/eggnog_4.5/eggnog4.functional_categories.txt) (broad functional category). You might want to make a paper sketch to get a better overview over the information contained in different eggNOG files.

</div>

</div>

</div>

<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">

<div class="text_cell_render border-box-sizing rendered_html">

## Questions[¶](#Questions)

We will use the information provided by eggNOG to explore highly conserved genes in the three domains of life, Bacteria, Archaea and Eukaryota. Your task is to answer the following questions:

1.  Which genes are universally required for an organism to survive? More precisely: Which genes (OGs) occur in at least 99% of all genomes in the eggNOG5 database in each domain of life, respectively? (The results should be around 100-300.)

    1.  How many such genes did you identify in each domain? **[2 points]**
    2.  Provide the results as three files (one for each domain) listing the OGs in sorted order (by name). **[3 points]**
2.  Which common bacterial genes occur almost exclusively as single-copy genes? More precisely: Which OGs occur in at least 50% of all bacterial genomes, and in at least 99% thereof as single-copy?

    1.  Provide the results as a sorted text file. **[3 points]**
    2.  How many of these OGs were also identified as universal bacterial OGs (previous question)? **[2 points]**
3.  Identify all OGs that occur as single-copy in at least 97% of all Archaea.

    1.  How many such OGs did you identify? Provide the result as a sorted text file. **[2 points]**
    2.  It would be interesting to know if there are archaeal genomes which substantially deviate from this "default" archaeal gene set. Are there Archaea which lack 4 or more of these universal OGs? Which organism (scientific name) lacks most? **[3 points]** What is its preferred growing temperature/environment? [0.5 bonus points]
4.  Compile an overview of the functional categories of these 121 archaeal OGs.

    1.  Provide the result as a text file sorted by the number of the functional categories. The result should look like shown below. **[5 points]**

<div class="highlight">

<pre><span></span>...
2    Replication, recombination and repair
1    Cell cycle control, cell division, chromosome partitioning
1    Signal transduction mechanisms
...
</pre>

</div>

</div>

</div>

</div>

<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">

<div class="text_cell_render border-box-sizing rendered_html">

## Required files and scripts[¶](#Required-files-and-scripts)

Relevant data files can be downloaded from the [eggNOG download page](http://eggnog5.embl.de/download/). We will use the database release eggNOG 5.0.

*   A template for a Bash driver script and the templates for two Python scripts are provided. Please let me know if you find any bugs.
*   Several eggNOG "members" or "annotations" files are required to answer the questions. You will need to inspect the provided scripts and the eggNOG download page to locate the required files.
*   An additionally required file, `functional_categories.txt`, is missing from eggNOG 5.0, but can be found in the previous eggNOG release.

Note that the eggNOG naming scheme is somewhat inconsistent for historical reasons: bacterial OGs have names like `2Z7HP` or `COG0001`, archaeal OGs have names like `2N551` or `arCOG00001`, and eukaryotic OGs have names like `2QPHS` or `KOG0001`. (OGs of the [root taxonomic level (LUCA)](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4702882/figure/F1/) also have names like `COG0001`, but were calculated independently from the bacterial level.)

</div>

</div>

</div>

<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">

<div class="text_cell_render border-box-sizing rendered_html">

## Project requirements[¶](#Project-requirements)

1.  Modify the provided scripts and solve the presented tasks.
2.  Answer the questions (you can put the answers in a `README` file, together with any other relevant information), and provide the scripts to reproduce your results. To obtain the max. number of points, runnable Python/Bash scripts must be provided together with the answers/results.
3.  Pack all relevant files as a `.tar.gz` file archive. Name the archive `python_final_<last_name_group_member_1>_<last_name_group_member_2>_<last_name_group_member_3>_<last_name_group_member_4>.tar.gz`
4.  Don't include the eggNOG data files in the archive (they are too large). Instead, the Bash script should download them if required.
5.  Before submitting the archive, it's recommended to unpack it in a clean folder, execute the Bash driver script and double-check that everything works as intended. It's also a good idea to do this on a different computer.
6.  I'll read the `README` file and execute the Bash driver script, which should run all other scripts and produce all required results.
7.  You can work in the same groups as for the exercises/group projects. The groups shouldn't exchange code with other groups.
8.  Grading is based not only on the correct answer, but also on the clarity of the solution and the readability of the code:
    *   Correctness: the extent to which code is consistent with project specifications and free of bugs
    *   Design: the extent to which code is written well (i.e., clearly, efficiently, elegantly, and/or logically)
    *   Style: the extent to which code is readable (i.e., docstrings, comments, etc.)

</div>

</div>

</div>

<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">

<div class="text_cell_render border-box-sizing rendered_html">

## Tips[¶](#Tips)

*   Designing/understanding the program logic is often more difficult than writing the code. Use print/logging and the debugger.
*   Use small files to test/develop the code. Compare the size of input data files, and use the smallest file for testing/developing. Another possibility is to subsample (take only a part of the data file).
*   Develop the code in stages. Once a part works, save this version. If you use a version control system like Git, commit/push the changes before continuing.
*   If something doesn't work, it has to be clear for the user what and why. Use assertions, argument checking etc.
*   Define all required constants (like file names) in one place, at the beginning of your script, or in a configuration file. Use no more constants than necessary.
*   Make sure that your program runs in reasonable time. Running each script should usually take seconds, depending on the size of the input data.
*   You might need to monitor the available RAM to prevent [swapping](https://stackoverflow.com/questions/19031902/what-is-thrashing-why-does-it-occur), otherwise it'll strongly impair performance. Reading the file `2_members.tsv.gz` with the script `read_members_file.py` required ~2.5 GB for me.
*   Don't forget about programming style (comments, docstrings, PEP8 naming conventions etc.). Use linters like Pylint and Flake8, and formatters like Black. There are some differences, e.g. regarding the [line length](https://black.readthedocs.io/en/stable/the_black_code_style.html), that's ok.
*   As the last stage of testing, run your complete workflow in a clean environment/folder.

</div>

</div>

</div>

<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">

<div class="text_cell_render border-box-sizing rendered_html">

* * *

</div>

</div>

</div>

<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">

<div class="text_cell_render border-box-sizing rendered_html">

# ASCII mirror cat[¶](#ASCII-mirror-cat)

1.  Write a function that creates a mirror image of the ASCII cat. The output should be the same cat looking to the other side. Start with creating a mirror image of `cat1`. When this works, modify your code so that it also works for `cat2`. You can use the provided template. **[1.5 bonus points]**

Hint:

*   Some characters have a mirror counterpart, e.g. `(` → `)` or `/` → `\`. You can create a dictionary for such lookups. You don't need all such characters, just those that are part of the cat. Some characters are escape characters that require a backslash or the raw string syntax, e.g. `print('ex\tamp\nle')` vs. `print(r'ex\tamp\nle')` ([Python docs](https://docs.python.org/3/reference/lexical_analysis.html#string-and-bytes-literals))

</div>

</div>

</div>

<div class="cell border-box-sizing code_cell rendered">

<div class="input">

<div class="inner_cell">

<div class="input_area">

<div class=" highlight hl-ipython3">

<pre><span></span><span class="k">def</span> <span class="nf">mirror_string</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">"""Mirrors string. Replaces characters that have counterparts, keeps the rest."""</span>
    <span class="k">assert</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span>
    <span class="k">return</span> <span class="s1">''</span>

<span class="k">def</span> <span class="nf">mirror</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">"""Mirrors multi-line string. Breaks it up into strings, mirrors them,</span>
 <span class="sd">puts them back together.</span>
 <span class="sd"></span> 
 <span class="sd">What about padding/alignment?</span>
 <span class="sd">"""</span>
    <span class="k">return</span> <span class="s1">''</span>

<span class="n">cat1</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"""</span>
 <span class="s2">_</span> 
 <span class="s2">/ )</span>
 <span class="s2">( (</span> 
 <span class="s2">A.-.A  .-""-.  ) )</span>
 <span class="s2">/ , , \/      \/ /</span> 
<span class="s2">=\  t  ;=    /   /</span> 
 <span class="s2">'--,'  .""|   /</span> 
 <span class="s2">|| |  \\ \</span> 
 <span class="s2">((,_|  ((,_\</span> 
<span class="s2">"""</span>

<span class="n">cat2</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"""</span>
 <span class="s2">_</span> 
 <span class="s2">/ )</span>
 <span class="s2">( (</span>
 <span class="s2">A.-.A  .-""-.  ) )</span>
 <span class="s2">/ , , \/      \/ /</span>
<span class="s2">=\  t  ;=    /   /</span>
 <span class="s2">'--,'  .""|   /</span>
 <span class="s2">|| |  \\ \</span>
 <span class="s2">((,_|  ((,_\</span>
<span class="s2">"""</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Cat 1:"</span><span class="p">,</span> <span class="n">cat1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Mirrored cat 1:"</span><span class="p">,</span> <span class="n">mirror</span><span class="p">(</span><span class="n">cat1</span><span class="p">))</span>
</pre>

</div>

</div>

</div>

</div>

</div>

<div class="cell border-box-sizing code_cell rendered celltag_remove_input">

<div class="output_wrapper">

<div class="output">

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result"><style>/* Interesting colors: lightseagreen, lightsteelblue, darkslateblue, slategray (for text), darkslategray, dimgray (heading), lightgray */ /* Lecture header */ table { display: inline-block } #lecture-header-logo { /*background-color: red;*/ /*text-align: left;*/ /*margin: 0px;*/ } #lecture-header-logo img { width: 130px; margin-left: 0; /*margin-right: auto;*/ } #lecture-header-title { /*background-color:blue;*/ color: gray; font-family: 'Trocchi', serif; font-size: 1.2em; font-weight: normal; line-height: 2; margin: 0px; } #lecture-header-info { /*background-color: orange;*/ color: gray; font-family: 'Trocchi', serif; font-size: 0.8em; margin: 0px; } h1 { color:slateblue; font-family: 'Palatino', serif; } div.header-separator p { color: slateblue; /*slateblue*/ /*margin: 10px 0px 0px 0px;*/ margin-top: 0px; margin-bottom: 25px; /*text-align: left*/ /*margin-top: 0.1em;*/ /*margin-bottom: 5em;*/ /*font-size: 10px;*/ /*position: absolute;*/ /*top: 20%;*/ } div.header-separator img { /*float: left;*/ /*background-color: slateblue;*/ width: 150px; margin-left: 0; /*margin-top: 0px;*/ /*margin-bottom: 20px;*/ /*margin: 0px 15px 15px 0px;*/ } /*------------------------*/ div.section-separator p { text-align: center; margin-top: 8em; margin-bottom: 8em; } div.section-separator img { width: 150px; } div.subsection-separator p { text-align: center; margin-top:4em; margin-bottom:4em; } div.subsection-separator img { width: 120px; } div.end-separator p { text-align: center; margin-top: 2em; margin-bottom: 4em; } div.end-separator img { width: 250px; filter: opacity(50%); } /*Filter styles*/ .saturate { filter: saturate(3); } .grayscale { filter: grayscale(100%); } .contrast { filter: contrast(160%); } .brightness { filter: brightness(0.25); } .blur { filter: blur(3px); } .invert { filter: invert(100%); } .sepia { filter: sepia(100%); } .huerotate { filter: hue-rotate(180deg); } .rss.opacity { filter: opacity(50%); } div.exercise { padding: 8px 35px 8px 14px; margin-bottom: 18px; color: #c09853; text-shadow: 0 1px 0 rgba(255, 255, 255, 0.5); background-color: #fcf8e3; border: 1px solid #fbeed5; -webkit-border-radius: 4px; -moz-border-radius: 4px; border-radius: 4px; color: darkgreen; background-color: #dff0d8; border-color: #d6e9c6; } div.challenge { background-color: #FFC; padding: 1.5em; text-align: left; /*max-width: 400px;*/ } div.selftest { padding: 8px 35px 8px 14px; margin-bottom: 18px; color: #c09853; text-shadow: 0 1px 0 rgba(255, 255, 255, 0.5); background-color: #fcf8e3; border: 1px solid #fbeed5; -webkit-border-radius: 4px; -moz-border-radius: 4px; border-radius: 4px; color: #2B547E; /*#3a87ad, darkslateblue*/ background-color: #d9edf7; border-color: #bce8f1; } .more { font-size:0.8em; color: slategray; } .alert.alert-info { color: darkblue; } .alert.alert-success { color: darkgreen; } .exercise-gray { padding: 10px; background-color: gray; /* Red */ color: white; margin-bottom: 10px; } div.lecture-figure img { margin-right: 15px; float: left; } a.img-caption { font-family: 'Comic Sans MS',sans-serif; /* 'Comic Sans MS',cursive,sans-serif */ display: block; /*margin-left: 15px;*/ /*margin: 2px 0 0 0;*/ } p.img-caption { color: green; /* royalblue steelblue midnightblue*/ font-family: 'Comic Sans MS',sans-serif; /*font-weight: bolder;*/ /* float:left; */ /* margin-left: 15px; */ } pre.bash code { /* colors from the Dracula theme */ background: #282a36; color: #f8f8f2; /* try midnight express, #21263A, https://www.htmlcsscolor.com/hex/21263A */ } pre.bash { background: #282a36; } /*ol {list-style-type: lower-alpha;}*/ ol.selftest { list-style-type: lower-alpha; } /* ---- Exercises ---- */ h1.home-assignment { font-size: 1em !important; color: teal !important; /*maroon, aqua, fuchsia, teal, */ /*background-color: black !important;*/ font-weight: bold !important; }</style></div>

</div>

</div>

</div>

</div>

<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">

<div class="text_cell_render border-box-sizing rendered_html">

* * *

</div>

</div>

</div>

</div>

</div>
